"0","classical_mean <- function(dat) {"
"0","  nobs <- sum(!is.na(dat$Y))"
"0","  Ymean <- mean(dat$Y, na.rm = TRUE)"
"0","  Yvar  <- var(dat$Y, na.rm = TRUE) / nobs"
"0","  # Return CI"
"0","  Ymean + c(-1, 1) * qt(0.975, nobs-1) * sqrt(Yvar)"
"0","}"
"0",""
"0","ppi_mean <- function(dat, adj = FALSE) {"
"0","  Yna <- is.na(dat$Y)"
"0","  nobs <- sum(!Yna)"
"0","  fit <- lm(Y ~ ., data = dat)"
"0","  Yobs_pred <- predict(fit, newdata = dat[!Yna, ])"
"0","  Ymis_pred <- predict(fit, newdata = dat[Yna, ])"
"0","  "
"0","  thetahat_obs <- mean(dat$Y[!Yna])"
"0","  thetahat_mis <- mean(Ymis_pred)"
"0","  thetahat_pp  <- thetahat_mis - mean(Yobs_pred - dat$Y[!Yna])"
"0","  "
"0","  varobs <- var(dat$Y[!Yna]) / nobs"
"0","  varmis <- var(Ymis_pred) / sum(Yna)"
"0","  varpp  <- varmis + 1/nobs * var(Yobs_pred - dat$Y[!Yna])"
"0","  "
"0","  # Return CI"
"0","  df <- nobs - length(coef(fit)) - 1"
"0","  teststat <- ifelse(adj, qnorm(1-alpha/2), qt(0.975, df))"
"0","  thetahat_pp + c(-1, 1) * teststat * sqrt(varpp)"
"0","}"
"0",""
"0","mice_mean <- function(dat) {"
"0","  imp <- mice(dat, "
"0","              m = 50,"
"0","              maxit = 10,"
"0","              method = ""norm"", "
"0","              eps = 0, "
"0","              print = FALSE)"
"0","  imp <- complete(imp, ""all"")"
"0","  means <- map_dbl(imp, ~mean(.x$Y))"
"0","  vars  <- map_dbl(imp, ~var(.x$Y)/nrow(.x))"
"0","  pooled <- pool.scalar(means, vars, n = nrow(dat))"
"0","  "
"0","  # Return CI"
"0","  pooled$qbar + c(-1, 1) * qt(0.975, pooled$df) * sqrt(pooled$t)"
"0","}"
